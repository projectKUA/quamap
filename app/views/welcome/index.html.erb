<html>
<head>
	<title>The Qua Map - Qua/Spa infomation!</title>
	<meta http-equiv="content-type" content="text/html; charset=utf-8" />
	<script type="text/javascript" src="//maps.google.com/maps/api/js?sensor=false"></script>
	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
	<script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/jquery-ui.min.js"></script>
	<link rel="stylesheet" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.2/themes/smoothness/jquery-ui.css">
	<script type="text/javascript">
/**  */
function getQuaDialogString(name, quality, effect, url){
	var ret =
		'<div id="content">'+
	  '<div id="siteNotice"></div>'+
	  '<h1 id="firstHeading" class="firstHeading" style="white-space: nowrap;">' + name + '</h1>'+
	  '<div id="bodyContent">'+
	  '<p style="white-space: nowrap;"><b>泉質:</b>' + quality + '</p>'+
	  '<p><b>効能:</b>' + effect + '</p>'+
	  '<p style="white-space: nowrap;"><b>HP:</b><a href="' + url + '" target="_brank">' + url + '</a></p>' +
	  '</div></div>';
	return ret;
}

	var styles = [
	{
		"featureType": "administrative.country",
		"stylers": [
			{ "visibility": "off" }
		]
	},{
		"elementType": "labels",
		"stylers": [
			{ "visibility": "off" }
		]
	},{
		"featureType": "landscape",
		"stylers": [
			{ "color": "#ffffff" }
		]
	},{
		"featureType": "poi",
		"stylers": [
			{ "visibility": "off" }
		]
	},{
		"featureType": "road",
		"elementType": "geometry.fill",
		"stylers": [
			{ "visibility": "on" },
			{ "color": "#ffffff" }
		]
	},{
		"elementType": "geometry.stroke",
		"stylers": [
			{ "color": "#cfcfd0" }
		]
	}
];

// 温泉情報　名称,緯度,経度,泉質,効能
var stations = [
    <% @quas.each do |q| %>
	[ '<%= q.name %>', <%= q.latitude %>, <%= q.longitude %>,'<%= q.quality.html_safe %>', '<%= q.effect.html_safe %>', '<%= q.url %>' ] <%= ", " unless q == @quas.last %>
    <% end %>
];

	(function($){
		$(function() {

			function mapClicked(e){
				$("#qua_latitude").val(e.latLng.lat());
				$("#qua_longitude").val(e.latLng.lng());
			}

			google.maps.event.addDomListener(window, 'load', function()
			{

				var center = new google.maps.LatLng(38.743224, 140.715955);
				var mapOptions = {
					zoom: 14,
					center: center,
					mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style'],
					scaleControl: true
				};
				var mapObj = new google.maps.Map(document.getElementById('gmap'), mapOptions);

				// Create a new StyledMapType object, passing it the array of styles,
				// as well as the name to be displayed on the map type control.
				var styledMap = new google.maps.StyledMapType(styles,
					{name: "Styled Map"});
				//Associate the styled map with the MapTypeId and set it to display.
				mapObj.mapTypes.set('map_style', styledMap);
				mapObj.setMapTypeId('map_style');

				// マーカーを作成
				var icon = new google.maps.MarkerImage('http://docs.google.com/uc?export=view&id=0B15A7hRyx7EIVjJTNkZpYjJGQlk',
					// This marker is 20 pixels wide by 32 pixels tall.
					new google.maps.Size(24, 24),
					// The origin for this image is 0,0.
					new google.maps.Point(0,0),
					// The anchor for this image is the base of the flagpole at 0,32.
					new google.maps.Point(0, 24)
				);

				$.each(stations, function()
				{
					var latlng = new google.maps.LatLng(this[1], this[2]);
					var marker = new google.maps.Marker({
						position: latlng,
						map: mapObj,
						title: this[0],
						icon: icon
					});
					var infowindow = new google.maps.InfoWindow({
						content: getQuaDialogString(this[0], this[3], this[4], this[5])
					});
					google.maps.event.addListener(marker, 'click', function() {
					  infowindow.open(mapObj,marker);
					});
				});
				var kmlLayer = new google.maps.KmlLayer({
					driveFileId: "0B2w7buxyq8qvU3hCZzFfWTFkajQ",
					preserveViewport: true
				});
				kmlLayer.setMap(mapObj);
				google.maps.event.addListener(mapObj, 'click', mapClicked);
			});

			$("#buttonEntryQua").click(function(){
				$("#dialog").dialog(
					{ buttons: [{
						text: "登録", click: function() {
							// #new_quaにsubmitを行なう。
							// 実行後にwelcome/index.html.erbを再表示する。
							$("#new_qua").submit();
							// $(this).dialog( "close" );
						}
					},{
						text: "キャンセル", click: function() {
							$(this).dialog( "close" );
						}
					}
				]});
			});
		});
	})(jQuery);
	</script>
</head>
<body>
	<h1>The QUA Map</h1>
	<p>日本温泉マップ</p>
	<div id="gmap" style="width: 99%; height: 500px; border: 1px solid Gray;">
	</div>
	<div>
		<br />
		<button id='buttonEntryQua' type='button'>温泉を登録する</button>
		<br />
		<a href='/quas' target='_blank'>Quas</button>
	</div>
<div id="dialog" title="温泉を登録する" style='display:none;'>
	<% @qua = Qua.new %>
	<%= render :template => 'quas/_form2' %>
</div>
</body>
</html>
